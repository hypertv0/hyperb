name: Dizilla M3U Scraper

on:
  schedule:
    # Runs daily at midnight UTC
    - cron: '0 0 * * *'
  workflow_dispatch:
    # Allows manual triggering from the GitHub Actions tab

jobs:
  scrape-and-commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Required for git-auto-commit-action to commit to the current branch
          token: ${{ secrets.GITHUB_TOKEN }} 
          
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Use the latest Python 3 version

      - name: Install dependencies
        # CRITICAL: Path to requirements.txt is relative to the repository root
        run: pip install -r dizilla/requirements.txt

      - name: Run Dizilla scraper
        # CRITICAL: Path to scraper.py is relative to the repository root
        run: python dizilla/scraper.py

      - name: Commit updated M3U file
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # CRITICAL: Specify the file to commit within the 'dizilla' subdirectory
          file_pattern: 'dizilla/dizilla.m3u'
          commit_message: "Auto: Update dizilla.m3u"
          # Optional: Configure commit user/email for clarity
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'actions@github.com'
          commit_author: 'GitHub Actions Bot <actions@github.com>'
